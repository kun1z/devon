#include <stdint.h>
#include <string.h>
//----------------------------------------------------------------------------------------------------------------------
// E7DDE140798F25F18A47C033F9CCD584EEA95AA61E2698D54D49806F304715BD57D05362054E288BD46F8E7F2DA497FFC44746A4A0E5FE90762E19D60CDA5B8C
//----------------------------------------------------------------------------------------------------------------------
void sha3_512mod(void * const out, void const * const in)
{
    uint64_t bc[5], st[25];

    memcpy(st, in, 64);
    memset(&st[8], 0, 136);

    for (int r=0;r<24;r++)
    {
        for (int i=0;i<5;i++)
        {
            bc[i] = st[i] ^ st[i + 5] ^ st[i + 10] ^ st[i + 15] ^ st[i + 20];
        }

        for (int i=0;i<5;i++)
        {
            const uint64_t t = bc[(i + 4) % 5] ^ ((bc[(i + 1) % 5] << 1) | (bc[(i + 1) % 5] >> 63));

            for (int j=0;j<25;j+=5)
            {
                st[j + i] ^= t;
            }
        }

        uint64_t t = st[1];

        for (int i=0;i<24;i++)
        {
            const int P[24] =
            {
                10, 7,  11, 17, 18, 3, 5,  16, 8,  21, 24, 4,
                15, 23, 19, 13, 12, 2, 20, 14, 22, 9,  6,  1,
            };

            const int R[24] =
            {
                1,  3,  6,  10, 15, 21, 28, 36, 45, 55, 2,  14,
                27, 41, 56, 8,  25, 43, 62, 18, 39, 61, 20, 44,
            };

            bc[0] = st[P[i]];
            st[P[i]] = (t << R[i]) | (t >> (64 - R[i]));
            t = bc[0];
        }

        for (int j=0;j<25;j+=5)
        {
            for (int i=0;i<5;i++)
            {
                bc[i] = st[j + i];
            }

            for (int i=0;i<5;i++)
            {
                st[j + i] ^= (~bc[(i + 1) % 5]) & bc[(i + 2) % 5];
            }
        }

        const uint64_t C[24] =
        {
            0X0000000000000001, 0X0000000000008082, 0X800000000000808A,
            0X8000000080008000, 0X000000000000808B, 0X0000000080000001,
            0X8000000080008081, 0X8000000000008009, 0X000000000000008A,
            0X0000000000000088, 0X0000000080008009, 0X000000008000000A,
            0X000000008000808B, 0X800000000000008B, 0X8000000000008089,
            0X8000000000008003, 0X8000000000008002, 0X8000000000000080,
            0X000000000000800A, 0X800000008000000A, 0X8000000080008081,
            0X8000000000008080, 0X0000000080000001, 0X8000000080008008,
        };

        st[0] ^= C[r];
    }

    memcpy(out, st, 64);
}
//----------------------------------------------------------------------------------------------------------------------